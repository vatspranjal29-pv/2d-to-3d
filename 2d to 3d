<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2D to 3D Demo</title>
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f5f5f5;
    color: #333;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 50px;
}
.container {
    text-align: center;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    width: 90%;
    max-width: 800px;
}
#viewer {
    margin-top: 20px;
    width: 100%;
    height: 500px;
    border: 1px solid #ddd;
}
input[type="file"] {
    margin-top: 15px;
}
</style>
</head>
<body>
<div class="container">
    <h1>2D â†’ 3D Demo</h1>
    <p>Upload your 2D image to see a 3D effect.</p>
    <input type="file" id="imageUpload" accept="image/*">
    <div id="viewer"></div>
</div>

<!-- Three.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls;
const viewer = document.getElementById("viewer");

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf5f5f5);

    camera = new THREE.PerspectiveCamera(45, viewer.clientWidth / viewer.clientHeight, 0.1, 1000);
    camera.position.set(0, 50, 100);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(viewer.clientWidth, viewer.clientHeight);
    viewer.appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(50, 50, 50);
    scene.add(light);

    const ambient = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambient);

    animate();
}

function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
}

// Convert image to 3D plane with heightmap
function create3DFromImage(image) {
    const img = new Image();
    img.src = URL.createObjectURL(image);
    img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, img.width, img.height).data;

        const geometry = new THREE.PlaneGeometry(img.width/10, img.height/10, img.width-1, img.height-1);
        for (let i = 0; i < geometry.attributes.position.count; i++) {
            const x = i % img.width;
            const y = Math.floor(i / img.width);
            const idx = (y * img.width + x) * 4;
            const brightness = data[idx] * 0.299 + data[idx+1]*0.587 + data[idx+2]*0.114;
            geometry.attributes.position.setZ(i, brightness / 10); // height
        }
        geometry.computeVertexNormals();

        const texture = new THREE.Texture(img);
        texture.needsUpdate = true;

        const material = new THREE.MeshStandardMaterial({ map: texture, side: THREE.DoubleSide });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.rotation.x = -Math.PI / 2;

        scene.clear();
        scene.add(mesh);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(50, 50, 50);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    }
}

document.getElementById("imageUpload").addEventListener("change", (e) => {
    create3DFromImage(e.target.files[0]);
});

init();
</script>
</body>
</html>
